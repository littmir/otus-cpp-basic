# Unit-тестирование

Тестирование - проверка на корректность.

Критерии корректности - определяются самостоятельно из ТЗ, здравого смысла и т.д.

Итог тестирования - подтверждение корректности программного продукта только в проверенных случаях.

Каждый модуль тестируется независимо.

Цель модульного тестирования - гарантировать корректность частей проекта, чтобы реже запускать ручное тестирование.

Быстрая валидация внесенных изменений.

Unit-тесты - отдельный исполняемый файл

**ААА-паттерн**:  
A - arrange - подготовка входных значений.  
A - act - действие, вызов функции.  
A - assert - проверка утверждений после действия.

## Google Test

Для стандартов C++17 и выше.

Тесты - автоматизация проверки того, что ничего не сломали в процессе разработки.

GTest из коробки поддерживается CMake.

xUnit архитектура - cases, fixtures, suits, runners.

**Suite** - логический набор тестов. Название для некоторой группы тестов.

Необходимо писать тесты в стиле **AAA**.

Результат работы GTest - исполняемый файл, в который можно передавать аргументы и фильтровать запускаемые тесты.

Провал **ASSERT_EQ** останавливает дальнейшее выполнение теста.

При провале **EXPECT_EQ** выполнение теста идёт дальше.

GTest позволяет как написать собственный main для исполняемого файл, так и слинковаться с его готовым вариантом.

```C++
int main(int argc, char **argv) {
  testing::InitGoogleTest(&argc, argv);
  RUN_ALL_TESTS();
  return 0;
}
```

Тесты можно отключать:

```C++
TEST(Suite, DISABLED_TestName) {}
```

**Fixture** - заранее подготовленное состояние до запуска теста, чтобы не копипастить в секции arrange.

**Fixture** - это класс отнаследованный публично от testing::Test.

В классе создаются все нужные данные, к членам класса имеется доступ во всех тестах.

Для работы с фикстурами используется макрос TEST_F, в которои первым аргументом идет название фикстуры, а не сьюта.

Есть 4 метода, которые GTest прелагает переопределить при использовании фикстуры:
- `static void SetupTestSuite()` - выполняется в начале тестового сьюта. В этой функции выполняется подготовка данных, которые нужны на протяжении всего тестового сьюта, и эти данные константные - не будут меняться внутри теста.
- `static void TearDownTestSuite()` - вызывается в конце тестового сьюта. Здесь выполняется очистка ресурсов.
- `void SetupUp() override` - вызывается перед началом каждого теста. Здесь готовятся неконстантные данные, которые могут в ходе теста меняться.
- `void TearDown() override` - вызывается в конце каждого теста. Очистка ресурсов.

Если секция **arrange** в нескольких тестах становится **одинаковой**, стоит использовать **фикстуры**.
